┌──────────────────────────────────────────────┐
│            物 理 散 射 形 成 层               │
├──────────────────────────────────────────────┤
│                                              │
│  入射光（λ, 偏振, 入射角）                   │
│        │                                     │
│        ▼                                     │
│  Wafer 表面 / 结构 / 缺陷                   │
│                                              │
│  • Particle → Rayleigh / Mie 散射            │
│  • Scratch  → 定向镜面散射                   │
│  • Pit/Void → 宽角随机散射                  │
│  • Roughness→ 高频散射                      │
│                                              │
│  ⇒ 产生异常散射光 ΔE(θ, φ, pol)              │
│                                              │
└──────────────────────────────────────────────┘
                         │
                         ▼
┌──────────────────────────────────────────────┐
│           角 域 / 偏 振 选 择 层               │
├──────────────────────────────────────────────┤
│                                              │
│  Dark Field 光学系统：                       │
│                                              │
│  • Specular / 正常衍射光被排除               │
│  • 仅收集异常散射角域                       │
│                                              │
│  多通道示例：                                │
│   - Low-angle DF                             │
│   - Mid-angle DF                             │
│   - High-angle DF                            │
│   - Co-pol / Cross-pol                      │
│                                              │
│  ⇒ 原始散射“物理指纹”被编码进通道            │
│                                              │
└──────────────────────────────────────────────┘
                         │
                         ▼
┌──────────────────────────────────────────────┐
│              探 测 与 采 样 层                │
├──────────────────────────────────────────────┤
│                                              │
│  探测器输出：                                │
│   I_k(x, y) = 散射信号 + 噪声                │
│                                              │
│  噪声模型：                                  │
│   • Photon noise (Poisson)                   │
│   • Read noise (Gaussian)                    │
│                                              │
│  多通道 / 多角度同步采样                     │
│                                              │
└──────────────────────────────────────────────┘
                         │
                         ▼
┌──────────────────────────────────────────────┐
│            缺 陷 检 出（Detection）           │
├──────────────────────────────────────────────┤
│                                              │
│  统计判决：                                  │
│                                              │
│  H₀: I ~ background + noise                  │
│  H₁: I ~ background + defect + noise         │
│                                              │
│  常用算子：                                  │
│   • Background subtraction                  │
│   • Local contrast (SNR)                    │
│   • Adaptive threshold                      │
│                                              │
│  ⇒ 输出：Defect Candidate (Blob / Patch)     │
│                                              │
└──────────────────────────────────────────────┘
                         │
                         ▼
┌──────────────────────────────────────────────┐
│          特 征 提 取（Feature）层             │
├──────────────────────────────────────────────┤
│                                              │
│  【几何特征】                                │
│   • Area / Size                              │
│   • Major / Minor Axis                       │
│   • Aspect Ratio                             │
│   • Orientation                              │
│                                              │
│  【强度 / 统计特征】                         │
│   • Peak / Mean / Sum intensity              │
│   • Std / Skewness / Kurtosis                │
│   • Local contrast                           │
│                                              │
│  【角度 / 偏振特征】                         │
│   • (I_low, I_mid, I_high)                   │
│   • Depolarization ratio                    │
│                                              │
│  【纹理 / 频域特征】                         │
│   • Local FFT energy                         │
│   • PSD slope                                │
│   • GLCM (contrast, entropy)                │
│                                              │
│  ⇒ 特征向量 f = (f₁, f₂, …, fₙ)              │
│                                              │
└──────────────────────────────────────────────┘
                         │
                         ▼
┌──────────────────────────────────────────────┐
│            特 征 规 范 化 / 筛 选              │
├──────────────────────────────────────────────┤
│                                              │
│  • Normalization / Scaling                  │
│  • Correlation removal                      │
│  • Robust statistics (outlier handling)     │
│                                              │
│  ⇒ 提升类内紧凑度，扩大类间距离               │
│                                              │
└──────────────────────────────────────────────┘
                         │
                         ▼
┌──────────────────────────────────────────────┐
│              分 类 / 判 决 层                 │
├──────────────────────────────────────────────┤
│                                              │
│  判决目标：                                  │
│   • Defect Type                              │
│   • Killer / Non-killer                     │
│                                              │
│  常见方法：                                  │
│   • Rule-based (工程稳定)                   │
│   • LDA / QDA                                │
│   • SVM / GBDT                               │
│   • CNN（patch-based）                      │
│                                              │
│  输出：                                      │
│   Defect Class + Confidence                 │
│                                              │
└──────────────────────────────────────────────┘
                         │
                         ▼
┌──────────────────────────────────────────────┐
│            统 计 聚 合 / Yield 层             │
├──────────────────────────────────────────────┤
│                                              │
│  • Pareto / Trend                            │
│  • Wafer map                                 │
│  • Lot / Tool signature                     │
│                                              │
│  ⇒ 工艺反馈 / Recipe 优化                    │
│                                              │
└──────────────────────────────────────────────┘
